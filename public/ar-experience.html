<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>AR Pokémon Alphabet</title>
  
  <!-- Tailwind CSS via CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  
  <!-- A-Frame and AR.js -->
  <script src="https://aframe.io/releases/1.0.4/aframe.min.js"></script>
  <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
  
  <style>
    /* Styles critiques qui ne peuvent pas être remplacés par Tailwind */
    body {
      margin: 0;
      padding: 0;
      overflow: hidden;
      position: fixed;
      width: 100vw;
      height: 100vh;
      -webkit-user-select: none;
      user-select: none;
    }
    
    /* Forcer la caméra à prendre tout l'écran */
    .a-canvas {
      width: 100vw !important;
      height: 100vh !important;
      position: absolute !important;
      top: 0 !important;
      left: 0 !important;
      z-index: 0 !important;
    }
    
    /* Cacher les contrôles VR */
    .a-enter-vr {
      display: none !important;
    }
    
    /* Supprimer les marges et bordures de la scène AR */
    #arjs-video {
      width: 100vw !important;
      height: 100vh !important;
      object-fit: cover !important;
      position: absolute !important;
      top: 0 !important;
      left: 0 !important;
      z-index: -1 !important;
    }
    
    /* Supprimer les bordures blanches */
    .a-body {
      background-color: transparent !important;
    }
    
    a-scene {
      z-index: 1;
      width: 100vw !important;
      height: 100vh !important;
    }
  </style>
</head>
<body class="bg-black">
  <!-- Loader -->
  <div id="loader" class="fixed inset-0 bg-black bg-opacity-80 z-50 flex items-center justify-center">
    <div class="text-white text-center">
      <svg class="animate-spin h-10 w-10 mx-auto mb-4" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
      </svg>
      <p>Chargement de la caméra...</p>
    </div>
  </div>

  <!-- AR Scene -->
  <a-scene 
    embedded 
    arjs="sourceType: webcam; 
          debugUIEnabled: false; 
          detectionMode: mono_and_matrix; 
          matrixCodeType: 3x3;
          sourceWidth: 1920;
          sourceHeight: 1080;
          displayWidth: window.innerWidth;
          displayHeight: window.innerHeight;"
    renderer="antialias: true; alpha: true; precision: mediump;"
    vr-mode-ui="enabled: false">

    <a-assets>
      <a-asset-item id="vaporeon-model" src="https://hebbkx1anhila5yf.public.blob.vercel-storage.com/pokedex_3d_pro_vaporeon-lu4Sdtq7SlzJwGKeWqITsTRDRIs4xv.glb"></a-asset-item>
      <a-asset-item id="flareon-model" src="https://hebbkx1anhila5yf.public.blob.vercel-storage.com/pokedex_3d_pro_flareon-ha6lLa8iAKSulkAgu5sby1mvilmWui.glb"></a-asset-item>
      <a-asset-item id="jolteon-model" src="https://hebbkx1anhila5yf.public.blob.vercel-storage.com/pokedex_3d_pro_jolteon-Chq0i0bWWUsgJR3mi0Qg7qF3yBQpgm.glb"></a-asset-item>
      <a-asset-item id="espeon-model" src="https://hebbkx1anhila5yf.public.blob.vercel-storage.com/pokedex_3d_pro_espeon-aqxxplrVA2dMeoC3cHPWinJuiSDcrg.glb"></a-asset-item>
      <a-asset-item id="glaceon-model" src="https://hebbkx1anhila5yf.public.blob.vercel-storage.com/pokedex_3d_pro_glaceon-7VWYKqy58HMQTN0k2WdnksUDQQTSiL.glb"></a-asset-item>
      <a-asset-item id="leafeon-model" src="https://hebbkx1anhila5yf.public.blob.vercel-storage.com/pokedex_3d_pro_leafeon-JHXyPt5E1MNXhJJQqNGtkI1e6gpuPI.glb"></a-asset-item>
    </a-assets>

    <a-marker preset="hiro" id="hiro-marker" emitevents="true" smooth="true" smoothCount="5">
      <a-entity
        id="pokemon-model"
        position="0 0 0"
        rotation="270 0 0"
        scale="2.5 2.5 2.5"
        gltf-model="#vaporeon-model"
      ></a-entity>
      <a-text
        id="pokemon-name"
        value="Vaporeon"
        position="0 -1 0"
        rotation="270 0 0"
        align="center"
        color="white"
        scale="2 2 2"
      ></a-text>
      <a-text
        id="pokemon-letter"
        value="V"
        position="0 1 0"
        rotation="270 0 0"
        align="center"
        color="#4285f4"
        scale="3 3 3"
      ></a-text>
    </a-marker>

    <a-entity camera></a-entity>
  </a-scene>
  
  <!-- UI Elements with Tailwind -->
  <div id="marker-status" class="fixed top-5 left-1/2 transform -translate-x-1/2 px-4 py-1 rounded-full bg-red-500 bg-opacity-80 text-white text-sm font-medium z-10 transition-all duration-300">
    Recherche de marqueur...
  </div>
  
  <button id="info-button" class="fixed top-5 left-5 w-10 h-10 bg-black bg-opacity-50 text-white border border-white border-opacity-30 rounded flex items-center justify-center text-xl cursor-pointer z-10">
    i
  </button>
  
  <div id="instructions" class="fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-20">
    <div class="max-w-md bg-black bg-opacity-70 rounded-lg p-5 text-white">
      <h2 class="text-xl font-bold mb-4">Visualiseur AR Pokémon</h2>
      <ol class="list-decimal pl-5 space-y-2 mb-5">
        <li>Pointez votre caméra vers un marqueur Hiro</li>
        <li>Un modèle 3D de Pokémon apparaîtra sur le marqueur</li>
        <li>Utilisez le sélecteur en bas pour changer de Pokémon</li>
        <li>Chaque lettre correspond à une évolution d'Évoli</li>
      </ol>
      <img src="https://raw.githubusercontent.com/AR-js-org/AR.js/master/data/images/hiro.png" alt="Marqueur Hiro" class="mx-auto h-32 w-32 border border-white border-opacity-20 mb-5">
      <button id="close-instructions" class="w-full py-2 bg-blue-500 text-white rounded font-medium">
        Commencer
      </button>
    </div>
  </div>
  
  <div class="fixed bottom-0 left-0 w-full bg-black bg-opacity-70 backdrop-blur-md p-3 z-10">
    <div id="pokemon-name-display" class="text-center text-white text-base mb-2">
      Vaporeon
    </div>
    <div class="flex justify-center gap-2 flex-wrap">
      <button class="letter-button active w-10 h-10 bg-blue-500 text-white border border-blue-500 rounded flex items-center justify-center font-bold text-lg" data-letter="V" data-model="#vaporeon-model" data-name="Vaporeon">V</button>
      <button class="letter-button w-10 h-10 bg-black bg-opacity-50 text-white border border-white border-opacity-30 rounded flex items-center justify-center font-bold text-lg" data-letter="F" data-model="#flareon-model" data-name="Flareon">F</button>
      <button class="letter-button w-10 h-10 bg-black bg-opacity-50 text-white border border-white border-opacity-30 rounded flex items-center justify-center font-bold text-lg" data-letter="J" data-model="#jolteon-model" data-name="Jolteon">J</button>
      <button class="letter-button w-10 h-10 bg-black bg-opacity-50 text-white border border-white border-opacity-30 rounded flex items-center justify-center font-bold text-lg" data-letter="E" data-model="#espeon-model" data-name="Espeon">E</button>
      <button class="letter-button w-10 h-10 bg-black bg-opacity-50 text-white border border-white border-opacity-30 rounded flex items-center justify-center font-bold text-lg" data-letter="G" data-model="#glaceon-model" data-name="Glaceon">G</button>
      <button class="letter-button w-10 h-10 bg-black bg-opacity-50 text-white border border-white border-opacity-30 rounded flex items-center justify-center font-bold text-lg" data-letter="L" data-model="#leafeon-model" data-name="Leafeon">L</button>
    </div>
  </div>
  
  <script>
    // Masquer le loader une fois que la scène est chargée
    window.addEventListener('load', function() {
      setTimeout(function() {
        const loader = document.getElementById('loader');
        loader.classList.add('hidden');
      }, 2000); // Attendre 2 secondes pour s'assurer que tout est chargé
    });

    document.addEventListener('DOMContentLoaded', function() {
      // Elements
      const markerStatus = document.getElementById('marker-status');
      const pokemonNameDisplay = document.getElementById('pokemon-name-display');
      const letterButtons = document.querySelectorAll('.letter-button');
      const infoButton = document.getElementById('info-button');
      const instructions = document.getElementById('instructions');
      const closeInstructionsButton = document.getElementById('close-instructions');
      const marker = document.getElementById('hiro-marker');
      const pokemonModel = document.getElementById('pokemon-model');
      const pokemonName = document.getElementById('pokemon-name');
      const pokemonLetter = document.getElementById('pokemon-letter');
      
      // Show/hide instructions
      closeInstructionsButton.addEventListener('click', function() {
        instructions.classList.add('hidden');
      });
      
      infoButton.addEventListener('click', function() {
        instructions.classList.remove('hidden');
      });
      
      // Marker detection events
      marker.addEventListener('markerFound', function() {
        console.log('Marker found!');
        markerStatus.textContent = 'Marqueur détecté';
        markerStatus.classList.remove('bg-red-500');
        markerStatus.classList.add('bg-green-500');
      });
      
      marker.addEventListener('markerLost', function() {
        console.log('Marker lost!');
        markerStatus.textContent = 'Recherche de marqueur...';
        markerStatus.classList.remove('bg-green-500');
        markerStatus.classList.add('bg-red-500');
      });
      
      // Letter selection
      letterButtons.forEach(button => {
        button.addEventListener('click', function() {
          // Update active button
          letterButtons.forEach(btn => {
            btn.classList.remove('active', 'bg-blue-500');
            btn.classList.add('bg-black', 'bg-opacity-50');
            btn.style.borderColor = 'rgba(255, 255, 255, 0.3)';
          });
          
          this.classList.add('active', 'bg-blue-500');
          this.classList.remove('bg-black', 'bg-opacity-50');
          this.style.borderColor = '#3b82f6';
          
          // Get data attributes
          const letter = this.getAttribute('data-letter');
          const modelUrl = this.getAttribute('data-model');
          const name = this.getAttribute('data-name');
          
          // Update model and text
          pokemonModel.setAttribute('gltf-model', modelUrl);
          pokemonName.setAttribute('value', name);
          pokemonLetter.setAttribute('value', letter);
          pokemonNameDisplay.textContent = name;
        });
      });

      // Force la caméra à prendre tout l'écran
      function fixCameraSize() {
        const video = document.querySelector('#arjs-video');
        if (video) {
          video.style.width = '100vw';
          video.style.height = '100vh';
          video.style.objectFit = 'cover';
          video.style.position = 'absolute';
          video.style.top = '0';
          video.style.left = '0';
          video.style.zIndex = '-1';
        }
        
        const canvas = document.querySelector('.a-canvas');
        if (canvas) {
          canvas.style.width = '100vw';
          canvas.style.height = '100vh';
        }
      }
      
      // Appliquer les corrections après le chargement et lors du redimensionnement
      window.addEventListener('load', fixCameraSize);
      window.addEventListener('resize', fixCameraSize);
      
      // Appliquer plusieurs fois pour s'assurer que ça fonctionne
      setTimeout(fixCameraSize, 1000);
      setTimeout(fixCameraSize, 2000);
      setTimeout(fixCameraSize, 3000);
    });
  </script>
</body>
</html>

